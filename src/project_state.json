{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 33,
  "summary": "Anonymous chatting web app (\"The Rorah Chat\") where users join/create rooms using only a nickname (no login), with dark mode, media upload/download, cross-device/network usability, persistent type bar, message reply/quote/react, edit/delete own messages, and distinct sent vs received chat bubble styling.",
  "architectural_notes": [
    "Room create/join flows are currently blocked because the backend actor initialization may never complete; frontend should not permanently disable room actions while actor is spinning up and must handle safe validation during initialization."
  ],
  "known_issues": [
    "Join button not working (cannot join room from join/create screen).",
    "Create Room screen: user cannot type a room name (room name input missing/disabled).",
    "Home screen/lobby: user cannot enter/join their chat room (blocked from navigating into room).",
    "Room validation is failing when attempting to enter/join a room (room code fails validation).",
    "Creating or joining rooms now fails due to backend actor connection/initialization not completing (room actions disabled or validation fails immediately).",
    "Chat UI shows sender userId above messages; should display sender nickname instead.",
    "Cannot reply to your own messages (reply action missing/disabled on messages sent by the current user)."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-create-the-core-anonymous-room-based-chat-flow-for-the-rorah-chat-users-can-enter-a-nickname-no-login-credentials-create-a-room-or-join-an-existing-room-and-then-view-send-messages-within-that-room",
      "title": "Create the core anonymous room-based chat flow for “The Rorah Chat”: users can enter a nickname (no login/credentials), create a room, or join an existing room, and then view/send messages within that room.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-add-dark-mode-support-across-the-ui-and-ensure-all-core-screens-join-create-room-chat-are-readable-and-styled-appropriately-in-dark-mode",
      "title": "Add dark mode support across the UI and ensure all core screens (join/create, room chat) are readable and styled appropriately in dark mode.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-support-sending-images-and-videos-in-chat-allow-a-user-to-upload-media-in-a-room-display-media-inline-in-the-message-timeline-and-allow-downloading-shared-media",
      "title": "Support sending images and videos in chat: allow a user to upload media in a room, display media inline in the message timeline, and allow downloading shared media.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-make-the-chat-ui-responsive-and-usable-across-devices-and-networks-implement-a-mobile-first-layout-handle-slow-intermittent-connectivity-with-retries-and-keep-message-fetching-reliable-without-real-time-sockets",
      "title": "Make the chat UI responsive and usable across devices and networks: implement a mobile-first layout, handle slow/intermittent connectivity with retries, and keep message fetching reliable without real-time sockets.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-message-composer-type-bar-is-always-visible-while-inside-a-chat-room-sticky-pinned-to-the-bottom-and-remains-accessible-while-scrolling-the-message-list",
      "title": "Ensure the message composer/type bar is always visible while inside a chat room (sticky/pinned to the bottom) and remains accessible while scrolling the message list.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-replies-quotes-and-reactions-allow-replying-to-an-older-message-showing-quoted-context-and-reacting-to-messages-e-g-emoji-reactions-with-counts",
      "title": "Implement replies/quotes and reactions: allow replying to an older message (showing quoted context) and reacting to messages (e.g., emoji reactions) with counts.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-allow-users-to-edit-and-delete-their-own-messages-only-ownership-must-work-without-login-by-using-a-stable-client-side-identifier-stored-locally-that-the-backend-checks-for-edit-delete-operations",
      "title": "Allow users to edit and delete their own messages only. Ownership must work without login by using a stable client-side identifier (stored locally) that the backend checks for edit/delete operations.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-differentiate-chat-bubble-styling-messages-sent-by-the-current-user-must-use-a-lighter-colored-bubble-than-messages-received-while-remaining-consistent-with-dark-mode",
      "title": "Differentiate chat bubble styling: messages sent by the current user must use a lighter-colored bubble than messages received, while remaining consistent with dark mode.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-a-cohesive-visual-theme-for-the-entire-app-colors-typography-spacing-component-styling-suitable-for-an-anonymous-chat-product-avoiding-blue-purple-as-the-primary-palette-and-use-the-theme-consistently-across-all-screens",
      "title": "Apply a cohesive visual theme for the entire app (colors, typography, spacing, component styling) suitable for an anonymous chat product, avoiding blue/purple as the primary palette, and use the theme consistently across all screens.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-lobby-join-room-flow-so-that-clicking-the-join-button-reliably-navigates-the-user-into-the-requested-room-when-the-room-exists-and-shows-a-clear-error-message-without-navigating-when-the-room-does-not-exist",
      "title": "Fix the Lobby \"Join Room\" flow so that clicking the Join button reliably navigates the user into the requested room when the room exists, and shows a clear error message (without navigating) when the room does not exist.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-the-roompage-error-handling-so-that-if-loading-messages-fails-due-to-a-non-existent-room-the-ui-communicates-that-the-room-was-not-found-and-provides-an-obvious-way-to-return-to-the-lobby",
      "title": "Improve the RoomPage error handling so that if loading messages fails due to a non-existent room, the UI communicates that the room was not found and provides an obvious way to return to the Lobby.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-browse-rooms-option-from-the-lobby-ui-so-users-can-only-create-a-room-or-join-by-room-code",
      "title": "Remove the \"Browse Rooms\" option from the Lobby UI so users can only create a room or join by room code.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-use-the-room-code-as-the-room-name-throughout-the-ui-when-creating-a-room-do-not-ask-for-or-store-a-separate-room-name-display-the-room-code-as-the-room-title-inside-the-chat-room",
      "title": "Use the room code as the room name throughout the UI: when creating a room, do not ask for or store a separate room name; display the room code as the room title inside the chat room.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-caffeine-watermark-branding-from-inside-the-chat-room-experience-when-the-user-is-viewing-a-room",
      "title": "Remove the Caffeine watermark/branding from inside the chat room experience (when the user is viewing a room).",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-lobby-create-room-tab-to-let-the-user-type-a-room-code-room-id-to-create-while-still-supporting-auto-generated-room-codes-when-the-input-is-left-blank-all-user-facing-labels-help-text-must-refer-to-room-code-not-room-name",
      "title": "Update the Lobby \"Create Room\" tab to let the user type a room code (room ID) to create, while still supporting auto-generated room codes when the input is left blank. All user-facing labels/help text must refer to \"Room code\" (not \"room name\").",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-add-client-side-validation-and-clear-error-handling-for-create-room-when-a-user-entered-room-code-is-invalid-or-already-exists-without-navigating-away-from-the-lobby",
      "title": "Add client-side validation and clear error handling for Create Room when a user-entered room code is invalid or already exists, without navigating away from the Lobby.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-lobbypage-join-room-flow-so-that-entering-a-valid-room-code-and-pressing-join-room-reliably-navigates-into-the-room-without-relying-on-fixed-delays-timeouts-or-stale-react-query-state",
      "title": "Fix the LobbyPage join-room flow so that entering a valid room code and pressing “Join Room” reliably navigates into the room, without relying on fixed delays/timeouts or stale React Query state.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-lobbypage-create-room-flow-validation-so-that-when-a-user-enters-a-custom-room-code-the-app-reliably-determines-whether-the-code-already-exists-before-attempting-to-create-and-join-without-using-fixed-delays-timeouts",
      "title": "Fix the LobbyPage create-room flow validation so that when a user enters a custom room code, the app reliably determines whether the code already exists before attempting to create and join, without using fixed delays/timeouts.",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-prevent-room-validation-from-incorrectly-returning-not-found-or-throwing-errors-while-the-backend-actor-is-still-initializing-so-joining-creating-rooms-does-not-fail-with-failed-to-validate-room-during-initial-load",
      "title": "Prevent room validation from incorrectly returning \"not found\" or throwing errors while the backend actor is still initializing, so joining/creating rooms does not fail with \"Failed to validate room\" during initial load.",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-frontend-validation-query-logic-so-that-unknown-validation-state-is-represented-distinctly-from-room-does-not-exist-and-ensure-message-loading-is-enabled-only-after-validation-succeeds",
      "title": "Fix the frontend validation/query logic so that \"unknown\" validation state is represented distinctly from \"room does not exist\", and ensure message loading is enabled only after validation succeeds.",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-add-an-edit-nickname-option-on-the-lobby-screen-the-screen-where-users-create-and-join-rooms-so-users-can-change-their-current-nickname-after-it-has-been-set-without-leaving-the-lobby",
      "title": "Add an \"Edit nickname\" option on the lobby screen (the screen where users create and join rooms) so users can change their current nickname after it has been set, without leaving the lobby.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-edit-nickname-ui-integrates-cleanly-with-the-existing-lobby-nickname-gate-so-that-if-the-nickname-is-cleared-set-to-an-empty-string-the-app-returns-to-the-choose-a-nickname-to-get-started-card-flow",
      "title": "Ensure the edit-nickname UI integrates cleanly with the existing lobby nickname gate so that if the nickname is cleared (set to an empty string), the app returns to the \"Choose a nickname to get started\" card flow.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-stop-blocking-the-lobby-create-join-room-flows-on-react-query-isfetching-for-the-backend-actor-treat-the-actor-as-ready-as-soon-as-an-actor-instance-exists-and-keep-the-ui-usable-while-background-refetches-occur",
      "title": "Stop blocking the Lobby create/join room flows on React Query \"isFetching\" for the backend actor; treat the actor as ready as soon as an actor instance exists, and keep the UI usable while background refetches occur.",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-room-validation-and-message-loading-query-enablement-so-roompage-does-not-get-stuck-in-an-indefinite-connecting-to-room-state-when-the-actor-exists-but-is-fetching-validation-should-run-whenever-an-actor-exists-and-message-loading-should-proceed-only-after-validation-returns-true",
      "title": "Update the room validation and message-loading query enablement so RoomPage does not get stuck in an indefinite \"Connecting to room...\" state when the actor exists but is fetching; validation should run whenever an actor exists, and message loading should proceed only after validation returns true.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-make-actor-initialization-state-in-the-ui-reflect-the-real-actor-lifecycle-show-connecting-only-when-the-actor-is-not-yet-available-and-avoid-triggering-room-validation-mutations-with-a-null-actor-ensure-errors-related-to-actor-creation-are-surfaced-clearly-to-the-user-in-english",
      "title": "Make actor initialization state in the UI reflect the real actor lifecycle: show \"Connecting...\" only when the actor is not yet available, and avoid triggering room validation/mutations with a null actor; ensure errors related to actor creation are surfaced clearly to the user in English.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-frontend-surfaces-a-clear-english-error-message-when-room-validation-fails-due-to-an-unexpected-backend-error-distinct-from-room-not-found-and-provide-an-obvious-retry-action-that-re-runs-validation-without-requiring-a-page-refresh",
      "title": "Ensure the frontend surfaces a clear, English error message when room validation fails due to an unexpected backend error (distinct from 'Room not found'), and provide an obvious retry action that re-runs validation without requiring a page refresh.",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-chat-message-composer-to-support-pasting-media-from-the-user-s-keyboard-clipboard-e-g-ctrl-cmd-v-into-the-message-input-attaching-the-pasted-file-for-sending",
      "title": "Update the chat message composer to support pasting media from the user’s keyboard/clipboard (e.g., Ctrl/Cmd+V) into the message input, attaching the pasted file for sending.",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-message-timeline-ui-to-render-pasted-uploaded-attachments-appropriately-based-on-mime-type-show-inline-previews-for-images-and-videos-for-all-other-file-types-show-a-downloadable-attachment-block-with-filename",
      "title": "Update the message timeline UI to render pasted/uploaded attachments appropriately based on MIME type: show inline previews for images and videos; for all other file types, show a downloadable attachment block with filename.",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-rebuild-and-redeploy-the-existing-application-as-is-no-functional-changes-ensuring-the-frontend-and-backend-compile-successfully-and-the-deployed-app-loads-without-runtime-errors",
      "title": "Rebuild and redeploy the existing application as-is (no functional changes), ensuring the frontend and backend compile successfully and the deployed app loads without runtime errors.",
      "reqIds": [
        "REQ-35"
      ],
      "version": 1
    },
    {
      "id": "feature-show-the-sender-s-nickname-not-the-sender-s-userid-to-message-recipients-throughout-the-chat-ui-including-the-message-header-and-reply-quote-context-blocks",
      "title": "Show the sender's nickname (not the sender's userId) to message recipients throughout the chat UI, including the message header and reply/quote context blocks.",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-add-explicit-download-options-for-all-media-attachments-images-videos-and-other-file-types-directly-from-the-message-timeline-ui",
      "title": "Add explicit download options for all media attachments (images, videos, and other file types) directly from the message timeline UI.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-optimize-chat-speed-and-performance-by-reducing-unnecessary-data-transfer-and-rendering-work-during-message-refreshes-while-keeping-message-fetching-reliable-without-real-time-sockets",
      "title": "Optimize chat speed and performance by reducing unnecessary data transfer and rendering work during message refreshes, while keeping message fetching reliable without real-time sockets.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-chat-ui-never-displays-a-sender-s-internal-userid-to-other-users-the-sender-label-shown-above-each-message-and-in-reply-quote-context-must-display-only-the-sender-s-nickname-and-if-no-nickname-is-available-it-must-display-a-generic-placeholder-e-g-anonymous-rather-than-the-userid",
      "title": "Ensure the chat UI never displays a sender's internal userId to other users; the sender label shown above each message (and in reply/quote context) must display only the sender's nickname, and if no nickname is available it must display a generic placeholder (e.g., \"Anonymous\") rather than the userId.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-higher-quality-send-experience-in-the-chat-composer-by-implementing-optimistic-message-sending-with-clear-pending-failed-ui-states-and-a-one-click-retry-action-when-sending-fails",
      "title": "Add a higher-quality send experience in the chat composer by implementing optimistic message sending with clear pending/failed UI states and a one-click retry action when sending fails.",
      "reqIds": [
        "REQ-41"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-message-timeline-consistency-by-stabilizing-message-ordering-and-reducing-visible-flicker-during-periodic-refreshes",
      "title": "Improve message timeline consistency by stabilizing message ordering and reducing visible flicker during periodic refreshes.",
      "reqIds": [
        "REQ-42"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-send-refresh-efficiency-in-the-react-query-data-flow-to-support-higher-messaging-quality-under-intermittent-connectivity-fewer-redundant-full-reloads-faster-convergence-after-send",
      "title": "Improve send/refresh efficiency in the React Query data flow to support higher messaging quality under intermittent connectivity (fewer redundant full reloads, faster convergence after send).",
      "reqIds": [
        "REQ-44"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-chat-message-ui-so-the-reply-action-is-available-for-messages-sent-by-the-current-user-as-well-as-messages-sent-by-other-users-i-e-remove-the-ui-restriction-that-hides-reply-on-own-messages-while-keeping-the-existing-behavior-that-hides-reply-on-pending-failed-optimistic-messages",
      "title": "Update the chat message UI so the Reply action is available for messages sent by the current user as well as messages sent by other users (i.e., remove the UI restriction that hides Reply on own messages), while keeping the existing behavior that hides Reply on pending/failed optimistic messages.",
      "reqIds": [
        "REQ-45"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Create anonymous chat rooms where users join/create rooms with only a nickname (no login credentials)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Add Dark Mode UI theme",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Support media upload (images/videos) and downloading shared media",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Ensure chat works across different networks and devices (responsive + reliable connectivity)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Keep the type bar always visible while in a chat room",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Enable replying/quoting older messages and reacting to messages",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Allow users to edit and delete their own messages",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Differentiate styling: sent messages use lighter color chat bubbles than received messages",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Implement persistent room message storage in the Motoko backend (single-actor) with APIs to: create room, list/fetch messages for a room (paged), post message, edit message, delete message, react to message, and upload/download media associated with a message.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Add a backend API to validate whether a room exists (without trapping) so the frontend can verify a room ID before navigating into the room.",
      "reqIds": [
        "REQ-12"
      ],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Remove/disable the \"Browse rooms\" option from the join/create (lobby) screen UI",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Use the room code as the room name displayed in the chat room UI (room title/header)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Remove the \"caffeine\" watermark from inside the chat room UI",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Ensure backend room validation remains non-trapping and consistently returns a boolean without throwing, and add any necessary defensive handling for empty/invalid room IDs to avoid unexpected frontend failures.",
      "reqIds": [
        "REQ-23"
      ],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Add an \"Edit nickname\" option on the lobby (create/join room) screen so users can change their nickname after initially setting it",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-20",
      "summary": "Fix the Motoko backend so that room creation persists correctly and validateRoom reliably returns true for rooms that were created, and false for rooms that do not exist, without trapping.",
      "reqIds": [
        "REQ-29"
      ],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Update backend room/message storage code to use correct persistent data structures/operations so that room existence checks and message storage do not rely on non-mutating operations (i.e., avoid patterns where add/put operations do not persist state).",
      "reqIds": [
        "REQ-30"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Allow users to paste media directly into chat from keyboard/clipboard (clipboard paste upload for any supported media type)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Extend the media/attachment model so chat messages can carry any file type (not only image/video) by storing and returning media metadata (at minimum: MIME type and original filename) along with the media bytes.",
      "reqIds": [
        "REQ-33"
      ],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Rebuild and redeploy the existing application as-is (no functional changes) to ensure frontend/backend compile and the deployed app loads without runtime errors",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Show sender nickname (not user ID) to message recipients in the chat UI",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "Add explicit UI controls to download received/sent media attachments from chat messages",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Optimize chat speed and overall performance (message loading/sending/rendering and backend interactions)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Update the backend public message formatting so the nickname returned for a message is never the sender's userId; if no nickname has been set for that userId, return a generic placeholder nickname (e.g., \"Anonymous\") instead of returning the userId as a fallback.",
      "reqIds": [
        "REQ-40"
      ],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Optimize overall messaging quality (reliability, consistency, and user-perceived message delivery/refresh experience)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "Fix the backend message retrieval API to respect pagination parameters and return messages in a predictable order to improve perceived message consistency and reduce unnecessary data transfer.",
      "reqIds": [
        "REQ-43"
      ],
      "status": "pending"
    },
    {
      "id": "AR-35",
      "summary": "Allow replying to your own messages (reply action should be available on messages sent by the current user)",
      "reqIds": [],
      "status": "in_progress"
    }
  ],
  "projectName": "The Rorah Chat",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}